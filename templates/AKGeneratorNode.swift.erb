// Copyright AudioKit. All Rights Reserved. Revision History at http://github.com/AudioKit/AudioKit/
// This file was auto-autogenerated by scripts and templates at http://github.com/AudioKit/AudioKitDevTools/

import AVFoundation
import CAudioKit

/// <%= description %>
public class <%= node %>: Node {

    public var connections: [Node] { [] }
    public var avAudioNode = instantiate2(instrument: "<%= four_letter_code %>")

<% tables.each do |table| -%>
<% table.each do |sp_var, data| -%>
    fileprivate var <%= data["ak-variable"] %>: Table?

<% end -%>
<% end -%>
<% unless tableArray.nil? -%>
    fileprivate var <%= tableArray %> = [Table]()

<% end -%>
<%= parameters_partial -%>
    // MARK: - Initialization

    /// Initialize this <%= one_word_desc %> node
    ///
    /// - Parameters:
<% unless tableArray.nil? -%>
    ///   - <%= tableArray %>: An array of exactly four waveforms
<% end -%>
<% tables.each do |table| -%>
<% table.each do |sp_var, data| -%>
    ///   - <%= data["ak-variable"] %>: The waveform of oscillation
<% end -%>
<% end -%>
<% (parameters + constants).each do |sp_parameter| -%>
<% sp_parameter.each do  |sp_var, data| -%>
    ///   - <%= data["ak-variable"] %>: <%= data["comment"] %>
<% end -%>
<% end -%>
    ///
    public init(
<% tables.each do |table| -%>
<% table.each do |sp_var, data| -%>
        <%= data["ak-variable"] %>: Table = Table(.sine),
<% end -%>
<% end -%>
<% unless tableArray.nil? -%>
        <%= tableArray %>: [Table] = [Table(.triangle), Table(.square), Table(.sine), Table(.sawtooth)],
<% end -%>
<% parameters.each_with_index do |sp_parameter, i| -%>
<% sp_parameter.each do  |sp_var, data| -%>
        <%= data["ak-variable"] %>: AUValue = <%= data["ak-variable"] %>Def.defaultValue<%= ",\n" if i < (parameters + constants).count - 1 -%>
<% end -%>
<% end -%>
<% constants.each_with_index do |sp_parameter, i| -%>
<% sp_parameter.each do  |sp_var, data| -%>
        <%= data["ak-variable"] %>: AUValue = <%= data["default"] %><%= ",\n" if i < constants.count - 1 -%>
<% end -%>
<% end %>
    ) {
        setupParameters()

        self.stop()
<% if tables.count > 0 %>
        auBase.setWavetable(waveform.content)
<% end -%>

<% unless tableArray.nil? -%>
        for (i, waveform) in <%= tableArray %>.enumerated() {
            auBase.setWavetable(waveform.content, index: i)
        }
        self.<%= tableArray %> = <%= tableArray %> 
<% end -%>
<% (tables+parameters).each do |sp_parameter| -%>
<% sp_parameter.each do  |sp_var, data| -%>
        self.<%= data["ak-variable"] %> = <%= data["ak-variable"] %>
<% end -%>
<% end -%>
    }
<% unless control_block.nil? -%>

    // MARK: - Control

<%= control_block %>
<% end -%>
}
